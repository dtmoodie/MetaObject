FILE(GLOB_RECURSE src "src/*.hpp" "src/*.cu" "src/*.cpp")

metaobject_declare_module(NAME core SRC src DEPENDS 
    ${OpenCV_LIBS} 
    Boost::thread
    Boost::fiber
    Boost::system
    cereal 
    RuntimeObjectSystem
)

target_include_directories(metaobject_core
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_BINARY_DIR}/include>
)
if(${MO_HAVE_CUDA})
    target_link_libraries(metaobject_core ${CUDA_CUDART_LIBRARY})
endif(${MO_HAVE_CUDA})

file(GLOB_RECURSE examples "examples/*.cpp")

foreach(example ${examples})
    get_filename_component(name ${example} NAME_WE)

    add_executable(mo_example_${name} ${example})

    target_link_libraries(mo_example_${name} metaobject_core)
endforeach()

if(BUILD_TESTS)
    file(GLOB_RECURSE tests "tests/*.cpp")
    add_executable(test_mo_core ${tests})
    target_link_libraries(test_mo_core metaobject_core)
    set_property(TARGET test_mo_core PROPERTY CXX_STANDARD 11)
endif()
